services:
  spa-worker:
    image: mycrocloud-deployment-worker:main
    build:
      context: ./worker
      dockerfile: Dockerfile
    env_file:
      - ./worker/.env
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./worker/.conf:/app/.conf:ro
      - /tmp/build-outputs:/tmp/build-outputs

  # The builder is usually run dynamically by the worker,
  # but kept here for image build/test purposes.
  builder:
    image: mycrocloud-deployment-builder:main
    build:
      context: ./builder
      dockerfile: Dockerfile
    environment:
      - REPO_URL=${REPO_URL:-}
      - WORK_DIR=.
      - OUT_DIR=dist
      - INSTALL_CMD=npm install
      - BUILD_CMD=npm run build
